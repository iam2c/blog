# 0x01 缘起
记得刚来J公司，做的一个项目，安卓APP自动升级功能，也可以降级。主要是这样的，APP客户端打开时，请求服务端看有没有可升级的APP版本，主要根据上次APP的VersionId（整型,自增，不是安卓APP的VersionCode）来判断的，当发现服务器返回的VersionId比上次的大，则根据返回的链接下载APK文件来升级。但是也有这种情况，发了新版本APP但是发现版本有问题，于是后台再增加一个版本VersionId，但是APK文件下载用的是上一个版本的，如果这样那么不管当前安装的APK跟新版本VersionId的APK是否一样，都会下载APK来重新安装。为了避免这个问题，我提出可以在接口增加一下APK文件的MD5值来解决，如果同一个文件MD5值应该是一样的，但是同事A提出来说这样还不如判断链接呢，我说域名什么的可能是会变的，但是文件是变不了的。他有点惊讶问道你怎么想到用这个方法来判断？我说这个都会想到的吧。
# 0x02 单向散列算法
单向散列算法，又称hash函数，Hash函数（也称杂凑函数或杂凑算法）就是把任意长的输入消息串变化成固定长的输出串的一种函数。这个输出串称为该消息的杂凑值。一般用于产生消息摘要，密钥加密等。单向散列函数的安全性使它能用于`完整性校验`和提高`数字签名`的有效性。常见算法：MD5/SHA(SHA1/SHA256)/CRC等（百度百科的定义）


我上面说的MD5值就是拿来做完整性校验。但是为什么很多人为什么只知道用于“加密密码”呢？

让我想起两句话：

1. `生活不止眼前的苟且，还有诗和远方的田野`
2. `生活中从不缺少美，而是缺少发现美的眼睛`

# 0x03 其实它并不是远方的田野
### 1. 完整性校验

当你去下载一些服务器（如Apache的httpd）的源码包的时候，你会不会发现类似这个：
![image](https://raw.githubusercontent.com/iam2c/blog/master/assets/img20161201113047.png)

当初你是否困惑这是用来干嘛的？当你点击MD5值，弹出的页面内容类似如下：

    04f19c60e810c028f5240a062668a688 *httpd-2.4.23.tar.bz2

签名的一串就是该文件的MD5签名，图中每个文件提供了三种签名值。当你下载完文件的时候可以对比文件的签名值是否和给出的一致，就可以验证文件的完整性，防止中途丢失数据或被篡改。

    这时你是不是觉得它其实离你不远，只是你没发现它而已。

上面只是完整性校验的作用而已，还有数字签名的作用。
### 2. 数字签名
对于数字签名的定义，百度百科是这么说的：

    数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。
    
不知道你是否做过微信公众号支付功能（如JSAPI支付方式）的，也许你做过，但是你没觉得里面有什么？因为你缺少发现“美”的眼睛。不记得可以在这里看：[网页端调起支付API](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7)，你会里面支付参数有一项签名和签名算法以及[生成签名算法](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=4_3)，那么为什么它要传这两个参数呢？

当然，肯定是为了安全。因为告诉微信你就是你而不是别人，以为签名生成需要用到公众号的AppId和密钥key，这两项就能表明你就是你，别人是没法冒充你的。

# 0x04 你又发现了什么
当你看完上面，你能发现什么东西呢？既然很多应用都用到它，是不是我们也许也能用到它？

1. 是不是也可以应用到APP接口中？
2. 是不是也可以拿来验证数据的一致性？

答案是肯定的。

1. 每个客户端产生一个唯一性标识id和key，利用MD5/SHA1等不可逆算法根据业务参数算出签名，和业务参数一起放到请求里面，但是key是不传播的。
2. 当你下载一个比较大的数据，你可以对数据签名并一起发送，接收方按照同样的方式算出签名，如果一致说明数据没有丢失，可以进行下一步操作。

    生活中从不缺少美，而是缺少发现美的眼睛

